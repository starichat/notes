# 接口调用统计框架

> 需求：开发一个小框架，能够获取接口调用的各种统计信息，比如，响应时间的最大值/最小值/平均值/百分位值/接口调用次数/频率等。
并且支持将统计结果输出到各种终端，以便于查看。

> 目标：
>1. 掌握线框图的需求分析手段
>2. 掌握测试驱动设计原则和最小原型设计原则
>3. 掌握框架开发的设计思路


## 需求分析
性能计数器作为一个跟业务无关的功能，我们完全可以把它开发成一个独立的框架或者类库，集成到很多业务系统中。

从需求中拆解出以下功能：
* 接口统计信息：包括接口响应时间的统计信息，以及接口调用次数的统计信息
* 统计信息的类型：max/min/avg/percentile/count/tps
* 统计信息显示格式：Json/Html。。。。
* 统计信息显示终端：Console。。。。

##  线框图分析
命令行数据：
```json
{
  "api1": {
    "max": 239,
    "min": 10,
    "avg": 124,
    "p99": 265,
    "p999": 309,
    "count": 6789,
    "tps": 101
  },
  "api2": {
    //...  
  } 
}
```
* 统计触发方式
* 统计时间区间
* 统计时间间隔

>非功能性设计
>* 易用性：跟业务代码是否松耦合，提供的接口是否够灵活
>* 性能：框架本身对cpu，对内存消耗很低，并且要低延时
>* 扩展性：在不修改或者尽量少修改代码的情况下添加新功能。使用者在不修改框架源码的情况下，为框架扩展新的功能。
>* 容错性：对外抛出的所有运行时/非运行时异常都进行捕获处理
>* 通用性：。。。
>
## 功能设计
这里结合TDD和Prototype的思想，聚焦于一个简单的应用场景，基于此设计实现一个简单的原型。

例如：这个性能计数器的小框架就可以聚焦于于一个小功能，比如统计用户注册、登陆这两个接口的响应时间的max、min、avg，并将该结果以json格式
输出到命令行中。

> 要输出接口的响应时间的最大值、平均值和接口调用次数，我们首先要采集每次接口请求的响应时间，并且存储起来，然后按照某个时间间隔做聚合统计，最后才是将结果输出。在原型系统的代码实现中，我们可以把所有代码都塞到一个类中，暂时不用考虑任何代码质量、线程安全、性能、扩展性等等问题，怎么简单怎么来就行。

从数据的角度分析：
1 数据采集
2 存储
3 聚合统计
4 显示
## 进度